<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/Turistforeningen/node-s3-uploader#readme"

    >s3-uploader (v2.0.3)</a>
</h1>
<h4>Resize, rename, and upload images to AWS S3</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.s3-uploader">module s3-uploader</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.s3-uploader">
            function <span class="apidocSignatureSpan"></span>s3-uploader
            <span class="apidocSignatureSpan">(bucketName, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image">
            function <span class="apidocSignatureSpan">s3-uploader.</span>Image
            <span class="apidocSignatureSpan">(src, opts, upload)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">s3-uploader.</span>Image.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.s3-uploader.Image">module s3-uploader.Image</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.Image">
            function <span class="apidocSignatureSpan">s3-uploader.</span>Image
            <span class="apidocSignatureSpan">(src, opts, upload)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.s3-uploader.Image.prototype">module s3-uploader.Image.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype._upload">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>_upload
            <span class="apidocSignatureSpan">(dest, version, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.getDest">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>getDest
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.getMetadata">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>getMetadata
            <span class="apidocSignatureSpan">(src, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.removeVersions">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>removeVersions
            <span class="apidocSignatureSpan">(results, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.resizeVersions">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>resizeVersions
            <span class="apidocSignatureSpan">(results, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.start">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>start
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.s3-uploader.Image.prototype.uploadVersions">
            function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>uploadVersions
            <span class="apidocSignatureSpan">(results, cb)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.s3-uploader" id="apidoc.module.s3-uploader">module s3-uploader</a></h1>


    <h2>
        <a href="#apidoc.element.s3-uploader.s3-uploader" id="apidoc.element.s3-uploader.s3-uploader">
        function <span class="apidocSignatureSpan"></span>s3-uploader
        <span class="apidocSignatureSpan">(bucketName, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Upload(bucketName, opts) {
  this.opts = opts || {};

  if (!bucketName) {
    throw new TypeError(&#x27;Bucket name can not be undefined&#x27;);
  }

  if (!this.opts.aws) { this.opts.aws = {}; }
  if (!this.opts.aws.acl) { this.opts.aws.acl = &#x27;private&#x27;; }

  if (!this.opts.aws.httpOptions) { this.opts.aws.httpOptions = {}; }
  if (!this.opts.aws.httpOptions.timeout) {
    this.opts.aws.httpOptions.timeout = 10000;
  }

  if (!this.opts.aws.maxRetries) { this.opts.aws.maxRetries = 3; }
  if (!this.opts.aws.params) { this.opts.aws.params = {}; }
  this.opts.aws.params.Bucket = bucketName;
  if (!this.opts.aws.path) { this.opts.aws.path = &#x27;&#x27;; }
  if (!this.opts.aws.region) { this.opts.aws.region = &#x27;us-east-1&#x27;; }
  if (!this.opts.aws.sslEnabled) { this.opts.aws.sslEnabled = true; }

  if (!this.opts.cleanup) { this.opts.cleanup = {}; }
  if (!this.opts.returnExif) { this.opts.returnExif = false; }

  if (!this.opts.resize) { this.opts.resize = {}; }
  if (!this.opts.resize.quality) { this.opts.resize.quality = 70; }

  if (!this.opts.versions) { this.opts.versions = []; }

  if (!this.opts.url &#x26;&#x26; this.opts.aws.region === &#x27;us-east-1&#x27;) {
    this.opts.url = `https://s3.amazonaws.com/${bucketName}/`;
  } else if (!this.opts.url &#x26;&#x26; this.opts.aws.region === &#x27;cn-north-1&#x27;) {
    this.opts.url = `https://s3.${this.opts.aws.region}.amazonaws.com/${bucketName}/`;
  } else if (!this.opts.url) {
    this.opts.url = `https://s3-${this.opts.aws.region}.amazonaws.com/${bucketName}/`;
  }

  this._randomPath = this.opts.randomPath || uuid;
  this.s3 = new S3(this.opts.aws);

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image" id="apidoc.element.s3-uploader.Image">
        function <span class="apidocSignatureSpan">s3-uploader.</span>Image
        <span class="apidocSignatureSpan">(src, opts, upload)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Image(src, opts, upload) {
  this.src = src;
  this.opts = opts;
  this.upload = upload;

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.s3-uploader.Image" id="apidoc.module.s3-uploader.Image">module s3-uploader.Image</a></h1>


    <h2>
        <a href="#apidoc.element.s3-uploader.Image.Image" id="apidoc.element.s3-uploader.Image.Image">
        function <span class="apidocSignatureSpan">s3-uploader.</span>Image
        <span class="apidocSignatureSpan">(src, opts, upload)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Image(src, opts, upload) {
  this.src = src;
  this.opts = opts;
  this.upload = upload;

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.s3-uploader.Image.prototype" id="apidoc.module.s3-uploader.Image.prototype">module s3-uploader.Image.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype._upload" id="apidoc.element.s3-uploader.Image.prototype._upload">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>_upload
        <span class="apidocSignatureSpan">(dest, version, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _upload(dest, version, cb) {
  if (version.awsImageAcl == null) {
    version.awsImageAcl = this.upload.opts.aws.acl;
  }

  const format = extname(version.path).substr(1).toLowerCase();

  const options = {
    Key: `${dest}${version.suffix || &#x27;&#x27;}.${format}`,
    ACL: version.awsImageAcl,
    Body: fs.createReadStream(version.path),
    ContentType: `image/${format === &#x27;jpg&#x27; ? &#x27;jpeg&#x27; : format}`,
  };

  if (version.awsImageExpires) {
    options.Expires = new Date(Date.now() + version.awsImageExpires);
  }

  if (version.awsImageMaxAge) {
    options.CacheControl = `public, max-age=${version.awsImageMaxAge}`;
  }

  this.upload.s3.putObject(options, (err, data) =&#x3e; {
    if (err) { return cb(err); }

    version.etag = data.ETag;
    version.key = options.Key;

    if (this.upload.opts.url) {
      version.url = this.upload.opts.url + options.Key;
    }

    return cb(null, version);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.getDest" id="apidoc.element.s3-uploader.Image.prototype.getDest">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>getDest
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDest(cb) {
  const prefix = this.opts.awsPath || this.upload.opts.aws.path;
  const path = this.opts.path || this.upload._randomPath();

  process.nextTick(() =&#x3e; cb(null, prefix + path));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.getMetadata" id="apidoc.element.s3-uploader.Image.prototype.getMetadata">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>getMetadata
        <span class="apidocSignatureSpan">(src, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMetadata(src, cb) {
  metadata(src, {
    exif: this.upload.opts.returnExif,
    autoOrient: true,
  }, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.removeVersions" id="apidoc.element.s3-uploader.Image.prototype.removeVersions">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>removeVersions
        <span class="apidocSignatureSpan">(results, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeVersions(results, cb) {
  each(results.uploads, (image, callback) =&#x3e; {
    if ((!this.upload.opts.cleanup.original &#x26;&#x26; image.original) ||
        (!this.upload.opts.cleanup.versions &#x26;&#x26; !image.original)
    ) {
      return setTimeout(callback, 0);
    }

    return fs.unlink(image.path, callback);
  }, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.resizeVersions" id="apidoc.element.s3-uploader.Image.prototype.resizeVersions">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>resizeVersions
        <span class="apidocSignatureSpan">(results, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resizeVersions(results, cb) {
  resize(results.metadata, {
    path: this.upload.opts.resize.path,
    prefix: this.upload.opts.resize.prefix,
    quality: this.upload.opts.resize.quality,
    versions: JSON.parse(JSON.stringify(this.upload.opts.versions)),
  }, cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.start" id="apidoc.element.s3-uploader.Image.prototype.start">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>start
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function start(cb) {
  auto({
    metadata: this.getMetadata.bind(this, this.src),
    dest: this.getDest.bind(this),
    versions: [&#x27;metadata&#x27;, this.resizeVersions.bind(this)],
    uploads: [&#x27;versions&#x27;, &#x27;dest&#x27;, this.uploadVersions.bind(this)],
    cleanup: [&#x27;uploads&#x27;, this.removeVersions.bind(this)],
  }, (err, results) =&#x3e; {
    cb(err, results.uploads, results.metadata);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  return this;
};

Upload.prototype.upload = function upload(src, opts, cb) {
  const image = new Image(src, opts, this);

  image.<span class="apidocCodeKeywordSpan">start</span>(cb);
};

module.exports = Upload;
module.exports.Image = Image;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.s3-uploader.Image.prototype.uploadVersions" id="apidoc.element.s3-uploader.Image.prototype.uploadVersions">
        function <span class="apidocSignatureSpan">s3-uploader.Image.prototype.</span>uploadVersions
        <span class="apidocSignatureSpan">(results, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function uploadVersions(results, cb) {
  if (this.upload.opts.original) {
    const org = JSON.parse(JSON.stringify(this.upload.opts.original));

    org.original = true;
    org.width = results.metadata.width;
    org.height = results.metadata.height;
    org.path = this.src;

    results.versions.push(org);
  }

  map(results.versions, this._upload.bind(this, results.dest), cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
